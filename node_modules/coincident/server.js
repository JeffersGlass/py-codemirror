Promise.withResolvers||(Promise.withResolvers=function(){var e,t,n=new this((function(n,r){e=n,t=r}));return{resolve:e,reject:t,promise:n}});const e="2b7f37dd-0f3c-4afb-a444-c83aed8deab7",t="M"+e,n="T"+e,r="apply",s="construct",o="defineProperty",a="deleteProperty",c="get",i="getOwnPropertyDescriptor",u="getPrototypeOf",l="has",f="isExtensible",p="ownKeys",g="preventExtensions",y="set",d="setPrototypeOf",w="delete",h="object",m="function",b="number",v="string",E="undefined",S="symbol",{defineProperty:M,getOwnPropertyDescriptor:P,getPrototypeOf:k,isExtensible:T,ownKeys:A,preventExtensions:O,set:x,setPrototypeOf:j}=Reflect,{assign:R,create:W}=Object,B=k(Int8Array),I="isArray",L=(e,t)=>{const{get:n,set:r,value:s}=e;return n&&(e.get=t(n)),r&&(e.set=t(r)),s&&(e.value=t(s)),e},D=(e,t)=>[e,t],N=e=>t=>{const n=typeof t;switch(n){case h:if(null==t)return D("null",t);if(t===globalThis)return D(h,null);case m:return e(n,t);case"boolean":case b:case v:case E:case"bigint":return D(n,t);case S:if($.has(t))return D(n,$.get(t))}throw new Error(`Unable to handle this ${n} type`)},$=new Map(A(Symbol).filter((e=>typeof Symbol[e]===S)).map((e=>[Symbol[e],e]))),_=e=>{for(const[t,n]of $)if(n===e)return t},J=e=>e;function U(){return this}const C="object"==typeof self?self:globalThis,z=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),r=s=>{if(e.has(s))return e.get(s);const[o,a]=t[s];switch(o){case 0:case-1:return n(a,s);case 1:{const e=n([],s);for(const t of a)e.push(r(t));return e}case 2:{const e=n({},s);for(const[t,n]of a)e[r(t)]=r(n);return e}case 3:return n(new Date(a),s);case 4:{const{source:e,flags:t}=a;return n(new RegExp(e,t),s)}case 5:{const e=n(new Map,s);for(const[t,n]of a)e.set(r(t),r(n));return e}case 6:{const e=n(new Set,s);for(const t of a)e.add(r(t));return e}case 7:{const{name:e,message:t}=a;return n(new C[e](t),s)}case 8:return n(BigInt(a),s);case"BigInt":return n(Object(BigInt(a)),s)}return n(new C[o](a),s)};return r})(new Map,e)(0),K="",{toString:Y}={},{keys:F}=Object,H=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=Y.call(e).slice(8,-1);switch(n){case"Array":return[1,K];case"Object":return[2,K];case"Date":return[3,K];case"RegExp":return[4,K];case"Map":return[5,K];case"Set":return[6,K]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},q=([e,t])=>0===e&&("function"===t||"symbol"===t),G=(e,{json:t,lossy:n}={})=>{const r=[];return((e,t,n,r)=>{const s=(e,t)=>{const s=r.push(e)-1;return n.set(t,s),s},o=r=>{if(n.has(r))return n.get(r);let[a,c]=H(r);switch(a){case 0:{let t=r;switch(c){case"bigint":a=8,t=r.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+c);t=null;break;case"undefined":return s([-1],r)}return s([a,t],r)}case 1:{if(c)return s([c,[...r]],r);const e=[],t=s([a,e],r);for(const t of r)e.push(o(t));return t}case 2:{if(c)switch(c){case"BigInt":return s([c,r.toString()],r);case"Boolean":case"Number":case"String":return s([c,r.valueOf()],r)}if(t&&"toJSON"in r)return o(r.toJSON());const n=[],i=s([a,n],r);for(const t of F(r))!e&&q(H(r[t]))||n.push([o(t),o(r[t])]);return i}case 3:return s([a,r.toISOString()],r);case 4:{const{source:e,flags:t}=r;return s([a,{source:e,flags:t}],r)}case 5:{const t=[],n=s([a,t],r);for(const[n,s]of r)(e||!q(H(n))&&!q(H(s)))&&t.push([o(n),o(s)]);return n}case 6:{const t=[],n=s([a,t],r);for(const n of r)!e&&q(H(n))||t.push(o(n));return n}}const{message:i}=r;return s([a,{name:c,message:i}],r)};return o})(!(t||n),!!t,new Map,r)(e),r},{parse:Q,stringify:V}=JSON,X={json:!0,lossy:!0};var Z=Object.freeze({__proto__:null,parse:e=>z(Q(e)),stringify:e=>V(G(e,X))}),ee=e=>({value:new Promise((t=>{let n=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");n.onmessage=t,n.postMessage(e)}))})
/*! (c) Andrea Giammarchi - ISC */;const{Int32Array:te,Map:ne,SharedArrayBuffer:re,Uint16Array:se}=globalThis,{BYTES_PER_ELEMENT:oe}=te,{BYTES_PER_ELEMENT:ae}=se,{isArray:ce}=Array,{notify:ie,wait:ue,waitAsync:le}=Atomics,fe=new WeakSet,pe=new WeakMap,ge={value:{then:e=>e()}};let ye=0;const de=(t,{parse:n=JSON.parse,stringify:r=JSON.stringify,transform:s,interrupt:o}=JSON)=>{if(!pe.has(t)){const a=(n,...r)=>t.postMessage({[e]:r},{transfer:n}),c=typeof o===m?o:o?.handler,i=o?.delay||42,u=new TextDecoder("utf-16"),l=(e,t)=>e?(le||ee)(t,0):(c?((e,t,n)=>{for(;"timed-out"===ue(e,0,0,t);)n()})(t,i,c):ue(t,0),ge);let f=!1;pe.set(t,new Proxy(new ne,{has:(e,t)=>"string"==typeof t&&!t.startsWith("_"),get:(e,r)=>"then"===r?null:(...e)=>{const o=ye++;let c=new te(new re(2*oe)),i=[];fe.has(e.at(-1)||i)&&fe.delete(i=e.pop()),a(i,o,c,r,s?e.map(s):e);const p=t!==globalThis;let g=0;return f&&p&&(g=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${r}(...args) is awaited`)),l(p,c).value.then((()=>{clearTimeout(g);const e=c[1];if(!e)return;const t=ae*e;return c=new te(new re(t+t%oe)),a([],o,c),l(p,c).value.then((()=>n(u.decode(new se(c.buffer).slice(0,e)))))}))},set(n,o,a){const c=typeof a;if(c!==m)throw new Error(`Unable to assign ${o} as ${c}`);if(!n.size){const o=new ne;t.addEventListener("message",(async t=>{const a=t.data?.[e];if(ce(a)){t.stopImmediatePropagation();const[e,c,...i]=a;let u;if(i.length){const[t,a]=i;if(n.has(t)){f=!0;try{const i=await n.get(t)(...a);if(void 0!==i){const t=r(s?s(i):i);o.set(e,t),c[1]=t.length}}catch(e){u=e}finally{f=!1}}else u=new Error(`Unsupported action: ${t}`);c[0]=1}else{const t=o.get(e);o.delete(e);for(let e=new se(c.buffer),n=0;n<t.length;n++)e[n]=t.charCodeAt(n)}if(ie(c,0),u)throw u}}))}return!!n.set(o,a)}}))}return pe.get(t)},we=(e,t)=>de(e,{...Z,...t});we.transfer=de.transfer=(...e)=>(fe.add(e),e);const he=new FinalizationRegistry((([e,t,n])=>{n&&console.debug(`Held value ${String(t)} not relevant anymore`),e(t)})),me=Object.create(null),be=(e,t,{debug:n,return:r,token:s=e}=me)=>{const o=r||new Proxy(e,me),a=[o,[t,e,!!n]];return!1!==s&&a.push(s),he.register(...a),o};var ve=(e,t)=>{const n=t&&new WeakMap;if(t){const{addEventListener:e}=EventTarget.prototype;M(EventTarget.prototype,"addEventListener",{value(t,r,...s){return s.at(0)?.invoke&&(n.has(this)||n.set(this,new Map),n.get(this).set(t,[].concat(s[0].invoke)),delete s[0].invoke),e.call(this,t,r,...s)}})}const I=t&&(e=>{const{currentTarget:t,target:r,type:s}=e;for(const o of n.get(t||r)?.get(s)||[])e[o]()});return function(n,$,U,...C){let z=0,K=this?.transform||J;const Y=new Map,F=new Map,{[U]:H}=n,q=C.length?R(W(globalThis),...C):globalThis,G=N(((e,t)=>{if(!Y.has(t)){let n;for(;F.has(n=z++););Y.set(t,n),F.set(n,e===h?K(t):t)}return D(e,Y.get(t))})),Q=e=>{H(w,D(v,e))},V=([e,n])=>{switch(e){case h:if(null==n)return q;if(typeof n===b)return F.get(n);if(!(n instanceof B))for(const e in n)n[e]=V(n[e]);return n;case m:if(typeof n===v){if(!F.has(n)){const e=function(...e){return t&&e.at(0)instanceof Event&&I(...e),H(r,D(m,n),G(this),e.map(G))};return F.set(n,new WeakRef(e)),be(n,Q,{return:e,token:!1})}return F.get(n).deref()}return F.get(n);case S:return _(n)}return n},X={[r]:(e,t,n)=>G(e.apply(t,n)),[s]:(e,t)=>G(new e(...t)),[o]:(e,t,n)=>G(M(e,t,n)),[a]:(e,t)=>G(delete e[t]),[u]:e=>G(k(e)),[c]:(e,t)=>G(e[t]),[i]:(e,t)=>{const n=P(e,t);return n?D(h,L(n,G)):D(E,n)},[l]:(e,t)=>G(t in e),[f]:e=>G(T(e)),[p]:e=>D(h,A(e).map(G)),[g]:e=>G(O(e)),[y]:(e,t,n)=>G(x(e,t,n)),[d]:(e,t)=>G(j(e,t)),[w](e){Y.delete(F.get(e)),F.delete(e)}};return n[$]=(e,t,...n)=>{switch(e){case r:n[0]=V(n[0]),n[1]=n[1].map(V);break;case s:n[0]=n[0].map(V);break;case o:{const[e,t]=n;n[0]=V(e);const{get:r,set:s,value:o}=t;r&&(t.get=V(r)),s&&(t.set=V(s)),o&&(t.value=V(o));break}default:n=n.map(V)}return X[e](V(t),...n)},{proxy:n,[e.toLowerCase()]:q,[`is${e}Proxy`]:()=>!1}}},Ee=ve("Window",!0),Se=e=>{let t=0;const n=new Map,E=new Map,P=Symbol(),k=e=>typeof e===m?e():e,T=e=>typeof e===h&&!!e&&P in e,A=Array[I];return function(O,x,j){const R=this?.transform||J,{[x]:W}=O,$=new Map,C=e=>{$.delete(e),W(w,z(e))},z=N(((e,r)=>{if(P in r)return k(r[P]);if(e===m){if(r=R(r),!E.has(r)){let e;for(;E.has(e=String(t++)););n.set(r,e),E.set(e,r)}return D(e,n.get(r))}if(!(r instanceof B)){e===h&&(r=R(r));for(const e in r)r[e]=z(r[e])}return D(e,r)})),K=e=>{const[t,n]=e;if(!$.has(n)){const r=t===m?U.bind(e):e,s=new Proxy(r,H);return $.set(n,new WeakRef(s)),be(n,C,{return:s,token:!1})}return $.get(n).deref()},Y=e=>{const[t,n]=e;switch(t){case h:return null===n?globalThis:typeof n===b?K(e):n;case m:return typeof n===v?E.get(n):K(e);case S:return _(n)}return n},F=(e,t,...n)=>Y(W(e,k(t),...n)),H={[r]:(e,t,n)=>F(r,e,z(t),n.map(z)),[s]:(e,t)=>F(s,e,t.map(z)),[o]:(e,t,n)=>{const{get:r,set:s,value:a}=n;return typeof r===m&&(n.get=z(r)),typeof s===m&&(n.set=z(s)),typeof a===m&&(n.value=z(a)),F(o,e,z(t),n)},[a]:(e,t)=>F(a,e,z(t)),[u]:e=>F(u,e),[c]:(e,t)=>t===P?e:F(c,e,z(t)),[i]:(e,t)=>{const n=F(i,e,z(t));return n&&L(n,Y)},[l]:(e,t)=>t===P||F(l,e,z(t)),[f]:e=>F(f,e),[p]:e=>F(p,e).map(Y),[g]:e=>F(g,e),[y]:(e,t,n)=>F(y,e,z(t),z(n)),[d]:(e,t)=>F(d,e,z(t))};O[j]=(e,t,s,o)=>{switch(e){case r:return Y(t).apply(Y(s),o.map(Y));case w:{const e=Y(t);n.delete(E.get(e)),E.delete(e)}}};const q=new Proxy([h,null],H),G=q.Array[I];return M(Array,I,{value:e=>T(e)?G(e):A(e)}),{[e.toLowerCase()]:q,[`is${e}Proxy`]:T,proxy:O}}},Me=Se("Window"),Pe=ve("Server",!1),ke=Se("Server"),Te=typeof Worker===m?Worker:class{};const{notify:Ae,wait:Oe}=Atomics,{parse:xe,stringify:je}=Z,Re=!!globalThis.process,We=new WeakMap,Be=e=>{let t;return/^!(-?\d+)?/.test(e)&&(t=RegExp.$1,e=e.slice(1+t.length)),{id:t,result:e?xe(e):void 0}},Ie=Re?(e,t)=>e.on("connection",(e=>{e.once("message",(n=>{let s=0;const[o,a]=xe(n),c=new Map,{[o]:i}=Pe({[a]:async(t,...n)=>{const o=je([t,...n]);if(t===r){const{promise:t,resolve:n}=Promise.withResolvers(),r=String(s++);return c.set(r,n),e.send("!"+r+o),await t}e.send("!"+o)}},o,a,t).proxy;e.on("close",(()=>{for(const[e,t]of c)t()})).on("message",(t=>{const{id:n,result:r}=Be(String(t));if(n){const e=c.get(n);c.delete(n),e(r)}else e.send(je(i(...r)))})).send("")}))})):(e,r,...s)=>{const o=we(e,...s);if(!We.has(o)){const s=e instanceof Te?Le:De;We.set(o,s(e,o,t,n,r))}return We.get(o)};Re||(Ie.transfer=we.transfer);const Le=(e,t,n,r,s)=>(e.addEventListener("message",(({data:[e,n]})=>{const r="M"+e,o="T"+e,{[o]:a}=t;let c;t[r]=(...e)=>new Promise((t=>{c=t,s.send(je(e))})),s.addEventListener("message",(()=>{s.addEventListener("message",(async({data:e})=>{const{id:t,result:n}=Be(e);if(null!=t){const e=a(...n);if(t){const n=await e;s.send("!"+t+(void 0===n?"":je(n)))}}else c&&(c=c(n))})),n[0]=1,Ae(n,0)}),{once:!0}),s.send(je([r,o]))}),{once:!0}),Ee(t,n,r)),De=(e,t,n,r)=>{const s="S"+crypto.randomUUID(),o=new Int32Array(new SharedArrayBuffer(4));return e.postMessage([s,o]),Oe(o,0),R(ke(t,"M"+s,"T"+s),Me(t,n,r))};export{Ie as default};
